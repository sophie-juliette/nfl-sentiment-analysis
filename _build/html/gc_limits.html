
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Adaption des PoCs an die Cloud &#8212; NFL Stimmungsbild</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="_static/logo.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Zukünftige Daten" href="gc_future.html" />
    <link rel="prev" title="Virtuelle Maschine" href="gc_introduction.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">NFL Stimmungsbild</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="Introduction.html">
                    Einleitung
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Proof of Concept
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="PoC_database.html">
   Datenbank
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="PoC_scrapping.html">
   Webscrapping
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="PoC_cloud.html">
   Kommentare &amp; Sentiment
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Cloud
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="gc_introduction.html">
   Virtuelle Maschine
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Adaption PoC
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="gc_future.html">
   Zukünftige Daten
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Daten
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="gc_analysis.html">
   Aufbereitung
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="gc_graphics.html">
   Analyse
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Abschluss
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="outlook.html">
   Ausblick und Fazit
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  ---------
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="sentimentfunc.html">
   sentiment.py-File
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Literatur.html">
   Literaturverzeichnis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Figures_Tables.html">
   Abbildungsverzeichnis
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/sophie-juliette/nfl-sentiment-analysis/master?urlpath=tree/gc_limits.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<a href="https://github.com/sophie-juliette/nfl-sentiment-analysis"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="bottom"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/gc_limits.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#webscrapping">
   Webscrapping
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#google-cloud-limits">
   Google Cloud Limits
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#youtube-api">
   Youtube-API
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sentiment-analyse">
   Sentiment Analyse
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Adaption des PoCs an die Cloud</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#webscrapping">
   Webscrapping
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#google-cloud-limits">
   Google Cloud Limits
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#youtube-api">
   Youtube-API
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sentiment-analyse">
   Sentiment Analyse
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="adaption-des-pocs-an-die-cloud">
<span id="gc-limits"></span><h1>Adaption des PoCs an die Cloud<a class="headerlink" href="#adaption-des-pocs-an-die-cloud" title="Permalink to this headline">#</a></h1>
<section id="webscrapping">
<h2>Webscrapping<a class="headerlink" href="#webscrapping" title="Permalink to this headline">#</a></h2>
<p>Für das Webscrapping wird der Code aus dem Proof of Concept auf einer Virtuellen Maschine mittels Cronjob gestartet.</p>
<p>Mit der Syntax <code class="docutils literal notranslate"><span class="pre">*/2</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span></code> wird die Datei alle 2 Minuten ausgeführt und damit stetig ein Link aus der Linkliste aufgerufen. Die Zeitverzögerung dient dazu das Erkennen des Scrappers zu vermeiden.</p>
</section>
<section id="google-cloud-limits">
<h2>Google Cloud Limits<a class="headerlink" href="#google-cloud-limits" title="Permalink to this headline">#</a></h2>
<p>Die im Proof of Concept verwendete Youtube API und die Sentiment-Analyse sind Teil der Google Cloud, welche bei der Erstregistrierung ein Startguthaben von 300 USD anbietet. Um dieses möglichst auszunutzen, wird wie erläutert, die weitere Scrapping-Infrastruktur ebenfalls in der Google Cloud gehalten.</p>
<p>Neben den Kosten für die virtuelle Machine sind die Youtube-API und Sentiment-Analyse die limitierenden Faktoren.</p>
<p>Ein kostenloser Account darf maximal 10.000 Abrufe über die Youtube-API anfordern. Dies enthält die Suche nach der Video-ID und den Abruf der Kommentare.<br />
Die Sentiment-Analyse ist sehr kostspielig mit 2 USD pro 1.000 Abfragen. Eine Abfrage darf maximal eintausend Zeichen enthalten. Zusätzliche Zeichen werden als eigene Abfrage gezählt.</p>
<figure class="align-default" id="sentiment-prices">
<img alt="_images/sentiment_prices.png" src="_images/sentiment_prices.png" />
<figcaption>
<p><span class="caption-number">Fig. 11 </span><span class="caption-text">Screenshot Google Cloud Sentiment Preise <span id="id1">[<a class="reference internal" href="Literatur.html#id10" title="cloud.google.com. Grundlagen der natural language api. https://cloud.google.com/natural-language/docs/reference/rest/v1/Entity. Accessed: 2022-12-12.">cloud.google.com, n.d.</a>]</span></span><a class="headerlink" href="#sentiment-prices" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="youtube-api">
<h2>Youtube-API<a class="headerlink" href="#youtube-api" title="Permalink to this headline">#</a></h2>
<p>Die Youtube-API wird im Rahmen der kostenlosen Nutzung auf 10.000 Quotas pro Tag begrenzt. Quotas können als Währung verstanden werden. Eine Suchanfrage kostet 100 Quotas. Je Videoabruf wird ein Quota fällig. Der Tagesverbrauch wird über eine Abklingzeit im Verlauf zurückgesetzt. D.h. man muss nicht zwingend 24 Stunden warten bis eine weitere Nutzung möglich ist.</p>
<p>Um das Limit nicht zu überschreiten, werden über im Cronjob pro Durchlauf zwei Dokumente der unverarbeiteten Videos geladen. Es werden ca. 2000 Kommentare pro Video erwartet. Unter Berücksichtigung der Limitierung kann der PoC-Code ca. 20 Videos pro Tag bearbeiten. Für die ersten 50 der 468 Videos werden alle Kommentare abgerufen, um die Funktionalität zu belegen. Diese betreffen die Woche 1 bis 4. Näheres dazu wird im Kapitel <a class="reference internal" href="gc_analysis.html#gc-analysis"><span class="std std-ref">Analyse</span></a> erläutert.</p>
<p>Die ca. 20 Videos ergeben sich aus 10.000 Quotas im Verhältnis zu den Kosten pro Video: <span class="math notranslate nohighlight">\(10000 / (2000 / 20 * 4 + 100)\)</span></p>
<p>Alleine für den Abruf der Kommentare sind ca. 24 Tage notwendig. Um die lange Laufzeit zu vermeiden werden nur die ersten 80 Kommentare abgerufen. Für die verbleibenden 418 Videos ergibt sich damit ein Wert von 96 Stück pro Tag.</p>
<p>Der Cronjob wird alle 4 Minuten mit folgenden Code ausgeführt. Über den ergänzten try-except-Block in <code class="docutils literal notranslate"><span class="pre">get_videoID_by_title()</span></code> wird ein permanentes Durchlaufen des Codes verhindert. Die Instanz zum Cronjob wird über einen Instanzterminplan täglich von 23 bis 8 Uhr gestartet.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>*/4 * * * * export DISPLAY=:0 &amp;&amp; export PATH=$PATH:/usr/local/bin &amp;&amp; cd /home/markusarmbrecht/ &amp;&amp; /home/markusarmbrecht/miniconda3/bin/python sentiment.py &gt;&gt; outputs.txt
</pre></div>
</div>
<p>Alternativ könnte ein Instanzterminplan und &#64;reboot-Cronjob angelegt werden. In diesem Fall muss eine Lösung fürs Quotalimit gefunden oder eine kostenpflichtige Abfrage genutzt werden.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>@reboot export DISPLAY=:0 &amp;&amp; export PATH=$PATH:/usr/local/bin &amp;&amp; cd /home/markusarmbrecht/ &amp;&amp; /home/markusarmbrecht/miniconda3/bin/python sentiment.py &gt;&gt; outputs.txt
</pre></div>
</div>
<p>Die <a class="reference external" href="http://sentiment.py">sentiment.py</a> enthält den Code aus dem Proof of Concept. Jedoch mit 2 Dokumenten, wie unten dargestellt wird, und ein Limit  auf 80 Kommentare je Video.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Auszug</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">myList</span> <span class="o">=</span> <span class="n">mycoll</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s1">&#39;videoID&#39;</span><span class="p">:{</span><span class="s1">&#39;$exists&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">}})[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">myList</span><span class="p">:</span>
    <span class="n">mongo_obj_id</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s1">&#39;_id&#39;</span><span class="p">]</span> <span class="c1"># ObjectID von mongoDB speichern</span>
    <span class="n">myTitle</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s1">&#39;team1&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">doc</span><span class="p">[</span><span class="s1">&#39;team2&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">doc</span><span class="p">[</span><span class="s1">&#39;week&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; Highlights | NFL 2021&#39;</span>
    <span class="n">vid_id</span> <span class="o">=</span> <span class="n">get_videoID_by_title</span><span class="p">(</span><span class="n">myTitle</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">vid_id</span> <span class="o">==</span> <span class="s2">&quot;NoQuota&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">vid_id</span><span class="p">)</span>
        <span class="k">break</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_videoID_by_title</span><span class="p">(</span><span class="n">video_title</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    takes: video_title as string</span>
<span class="sd">    returns: videoId as string</span>
<span class="sd">    describtion:</span>
<span class="sd">        builds a connection to Youtube Data API and executes a search method to list results.</span>
<span class="sd">        searches for channelId from NFL-Youtube Channel, for videos only</span>
<span class="sd">        returns videoID for most relevant search result</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">youtube</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="s1">&#39;youtube&#39;</span><span class="p">,</span> <span class="s1">&#39;v3&#39;</span><span class="p">,</span> 
                    <span class="n">developerKey</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">youtube</span><span class="o">.</span><span class="n">search</span><span class="p">()</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
        	        <span class="n">part</span><span class="o">=</span><span class="s1">&#39;snippet&#39;</span><span class="p">,</span>
                	<span class="n">q</span><span class="o">=</span><span class="n">video_title</span><span class="p">,</span>
                	<span class="n">channelId</span><span class="o">=</span><span class="s1">&#39;UCDVYQ4Zhbm3S2dlz7P1GBDg&#39;</span><span class="p">,</span> <span class="c1"># NFL Channel ID</span>
                	<span class="nb">type</span><span class="o">=</span><span class="s1">&#39;video&#39;</span><span class="p">,</span>
                	<span class="n">order</span><span class="o">=</span><span class="s1">&#39;relevance&#39;</span><span class="p">,</span> <span class="c1"># Default Value = relevance</span>
                	<span class="n">maxResults</span><span class="o">=</span><span class="mi">1</span>
                	<span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">][</span><span class="s1">&#39;videoId&#39;</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;NoQuota&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Die folgende Grafik zeigt den beschriebenen Kontingentverbrauch.</p>
<figure class="align-default" id="yt-api-konti">
<img alt="_images/ytapi_kontigent.png" src="_images/ytapi_kontigent.png" />
<figcaption>
<p><span class="caption-number">Fig. 12 </span><span class="caption-text">Screenshot Youtube API Kontingent</span><a class="headerlink" href="#yt-api-konti" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="sentiment-analyse">
<h2>Sentiment Analyse<a class="headerlink" href="#sentiment-analyse" title="Permalink to this headline">#</a></h2>
<p>Jedoch ist die Youtube API nicht der Flaschenhals des Projekts. Die Sentimentanalyse ist kostspielig und für die absolute Menge an Kommentaren wird das Guthaben nicht ausreichen.<br />
Im Durchlauf für die Wochen 1 bis 4 sind ca 150 USD an Kosten angefallen. Ein Erwartungswert wurde mit einem Schätzwert von ca 2000 Kommentaren je Video ermittelt: <span class="math notranslate nohighlight">\(50 * 2000 * 0,002 = 200\)</span></p>
<p>Nach der Drosselung auf 80 Kommentare pro Video können folgende Kosten erwartet werden.</p>
<p><span class="math notranslate nohighlight">\(418 Videos * 4 PageTokens * 20 Kommentare = 33.440 Kommentare\)</span><br />
<span class="math notranslate nohighlight">\(33.440 * 0,002 = 66,88\)</span></p>
<p>Die Limitierung erfolg über die Funktion <code class="docutils literal notranslate"><span class="pre">get_comments()</span></code> aus dem Proof of Concept. Dabei wird der Counter auf 4 gesetzt, um den While-Loop nach 80 Kommentaren zu verlassen. (siehe nachfolgenden Code)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myList</span> <span class="o">=</span> <span class="n">mycoll</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s1">&#39;videoID&#39;</span><span class="p">:{</span><span class="s1">&#39;$exists&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">}})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_comments</span><span class="p">(</span><span class="n">vidId</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    takes: youtube video id as string, global api_key as string</span>
<span class="sd">    returns: list of toplevel-comments under video (no replies)</span>
<span class="sd">    describtion:</span>
<span class="sd">        builds a connection to Youtube Data API and executs commentsThreads().list() methods</span>
<span class="sd">        iterates over response from api request and stores displayed text as string in an list</span>
<span class="sd">        breaks if no NextPageToken is provided. Thus end of comments is reached.</span>
<span class="sd">        breaks if counter &lt; threshold-value prevent Youtube out of quota error</span>
<span class="sd">        returns list with comments</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># list for several pages</span>
    <span class="n">comments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">4</span> <span class="c1"># entfällt beim 50-Video Durchlauf</span>

    <span class="c1"># get youtube access</span>
    <span class="n">youtube</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="s1">&#39;youtube&#39;</span><span class="p">,</span> <span class="s1">&#39;v3&#39;</span><span class="p">,</span> 
                <span class="n">developerKey</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
    
    <span class="c1"># get response</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">youtube</span><span class="o">.</span><span class="n">commentThreads</span><span class="p">()</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
	            <span class="n">part</span><span class="o">=</span><span class="s1">&#39;snippet&#39;</span><span class="p">,</span>
	            <span class="n">videoId</span><span class="o">=</span><span class="n">vidId</span><span class="p">,</span>
                <span class="n">textFormat</span><span class="o">=</span><span class="s1">&#39;plainText&#39;</span>
	            <span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

    <span class="c1"># iterate over comments and append to output list</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]:</span>
            <span class="n">comments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;snippet&#39;</span><span class="p">][</span><span class="s1">&#39;topLevelComment&#39;</span><span class="p">][</span><span class="s1">&#39;snippet&#39;</span><span class="p">][</span><span class="s1">&#39;textDisplay&#39;</span><span class="p">])</span>
        
        <span class="n">counter</span> <span class="o">-=</span> <span class="mi">1</span>       <span class="c1"># Entfällt beim 50-Video Durchlauf</span>
        <span class="k">if</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="k">if</span> <span class="s1">&#39;nextPageToken&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">youtube</span><span class="o">.</span><span class="n">commentThreads</span><span class="p">()</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
	                <span class="n">part</span><span class="o">=</span><span class="s1">&#39;snippet&#39;</span><span class="p">,</span>
                    <span class="n">pageToken</span><span class="o">=</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;nextPageToken&#39;</span><span class="p">],</span>
	                <span class="n">videoId</span><span class="o">=</span><span class="n">vidId</span>
	                <span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>
    
    <span class="k">return</span> <span class="n">comments</span>
</pre></div>
</div>
</div>
</div>
<p>Die folgende Grafik zeigt den Traffic in der Google Cloud. Der Verbrauch der Youtube-API ist in blau und die der Sentiment Analyse in orange eingezeichnet.</p>
<p>Zu erkennen ist der rasante Anstieg der Youtube-Fehlerquote, sobald die Youtube Quota aufgebraucht ist. Mit etwas mehr Code könnte auch ein Abschalten der Instanz getriggert werden, wenn die “Out of Quota”-Fehlermeldung zurückgegeben wird.</p>
<p>Bei der orangenen Linie ist zu erkennen, dass der Code wie geplant nicht zur Sentiment Analyse durchläuft.</p>
<figure class="align-default" id="yt-api-traffic">
<img alt="_images/ytapi_track_traffic.png" src="_images/ytapi_track_traffic.png" />
<figcaption>
<p><span class="caption-number">Fig. 13 </span><span class="caption-text">Screenshot Google Cloud Traffic</span><a class="headerlink" href="#yt-api-traffic" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="gc_introduction.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Virtuelle Maschine</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="gc_future.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Zukünftige Daten</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Markus Armbrecht und Sophie Horn<br/>
  
    <div class="extra_footer">
      <div> Projektarbeit zu Web- & Social Media Analytics<br> im Wintersemester 2022/23<br> <br> <a target="_blank" href="https://icons8.com/icon/xZc9kxSKqmeM/american-football-spieler">American Football-Spieler</a> icon by <a target="_blank" href="https://icons8.com">Icons8</a> <br> <a href="https://github.com/TheArmbreaker" target="_blank"><img src="https://img.shields.io/badge/Github-Markus%20Armbrecht-orange" alt="Github Markus Armbrecht"></a> <a href="https://github.com/sophie-juliette" target="_blank"><img src="https://img.shields.io/badge/Github-Sophie%20Horn-brightgreen" alt="Github Sophie Horn"></a> </div>
    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>